#!/usr/bin/env python2.7
# coding=utf-8

# with open(r'api_list.txt', 'rb') as f:
#     apis = f.read().splitlines()

apis = [
    'CloseHandle', 'VirtualFree', # ...
]

# Seed value is hardcoded into the sample
seed = 0x29A

for x in apis:
    api = x.upper()

    h = seed * len(api)

    for n, c in enumerate(api):
        h += (len(api) - n) * ord(c)

    modifier = sum(ord(c) for c in api) + seed

    if modifier >= 0xFFF0:
        modifier -= 0xFFF1

    edx = ((0x80078071 * modifier) & 0xFFFFFFFF00000000) >> 0x2F
    eax = (edx * 0xFFF1) & 0xFFFFFFFF

    modifier -= eax

    edx = ((0x80078071 * h) & 0xFFFFFFFF00000000) >> 0x2F
    eax = (edx * 0xFFF1) & 0xFFFFFFFF

    h -= eax

    h = (h << 0x10) | modifier

    print('[0x%08X] %s' % (h, x))
